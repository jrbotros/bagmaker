function toggleBagSizeUI(){var e=$(".bag-size-wrap");e.hasClass("small")?(e.removeClass("small"),setTimeout(function(){e.addClass("big")},300),newBag.toggleSize("big")):(e.removeClass("big"),setTimeout(function(){e.addClass("small")},300),newBag.toggleSize("small"))}var newBag;$(document).ready(function(){function e(e){var t=e.parents(".editable-field"),a=_.findWhere(newBag.data.textfields,{domid:t.attr("id")});if(e.parent().hasClass("size")){var s=e.val();t.css("font-size",s+"em"),a.fontSize=Number(s)}else if(e.parent().hasClass("kerning")){var i=e.val();t.css("letter-spacing",i+"em"),a.kerning=Number(i)}else if(e.parent().hasClass("leading")){var n=e.val();t.css("line-height",n+"em"),a.leading=Number(n)}newBag.updateTextAreaSize(t.find("textarea"))}newBag=_.extend({},bagObject),newBag.data.editMode=!0,newBag.newTextField(),newBag.draw($(".content.create-page .bag-wrap"),function(){$(".editable-field").eq(0).addClass("selected"),$(".editable-field").eq(0).find("textarea").focus(),setTimeout(function(){var e=$(".content.create-page").height()-$(window).height();$(".content-wrap").animate({scrollTop:e},"fast")},100)}),$(document).hammer().on("tap",".bag-size-wrap",function(e){e.preventDefault(),e.stopPropagation(),toggleBagSizeUI()}),$(document).hammer().on("tap",".color-control-wrap .color-control",function(e){e.preventDefault(),e.stopPropagation(),$(this).parents(".color-control-wrap").toggleClass("expand")}),$(document).hammer().on("tap",".color-control-wrap .colors .color-wrap",function(e){e.preventDefault(),e.stopPropagation();var t=$(this).parents(".color").attr("rel");newBag.changeColor(t),$(".colors .color.selected").removeClass("selected"),$(this).parent(".color").addClass("selected"),$(this).parents(".color-control-wrap").removeClass("expand")}),$(document).hammer().on("tap",".addTextfield:not(.disabled)",function(e){e.preventDefault(),e.stopPropagation(),$(".editable-field.new").length>0?($(".editable-field").removeClass("selected"),setTimeout(function(){$(".editable-field.new").eq(0).addClass("selected")},100)):(newBag.newTextField(),newBag.draw())}),$(document).hammer().on("tap",".editable-field .corner.tr",function(e){e.preventDefault(),e.stopPropagation();var t=$(this).parents(".editable-field").attr("id");newBag.deleteTextField(t,function(){0===newBag.data.textfields.length&&$("button.save").addClass("disabled")})}),$(document).on("keypress, keydown",".editable-field textarea",function(){$(this).val().length>=site.textfieldMaxLength&&$(this).val($(this).val().substr(0,site.textfieldMaxLength))}),$(document).on("keypress, keyup",".editable-field textarea",function(){if($(this).val().length>=site.textfieldMaxLength){var e=$(this);setTimeout(function(){e.val(e.val().substr(0,site.textfieldMaxLength))},20)}newBag.updateTextAreaSize($(this))}),$(document).hammer().on("tap",".editable-field",function(e){e.preventDefault(),e.stopPropagation(),$(".editable-field").removeClass("selected"),$(this).addClass("selected")}),$(document).hammer().on("tap",":not(.editable-field, .editable-field *)",function(e){e.preventDefault(),e.stopPropagation(),$(".editable-field.selected").removeClass("selected")}),$(document).hammer().on("tap",".text-controls .justification > *",function(e){e.preventDefault(),e.stopPropagation();var t=$(this).parents(".editable-field"),a=_.findWhere(newBag.data.textfields,{domid:t.attr("id")});$(this).siblings(".sel").removeClass("sel");var s=$(this).attr("class").split("-")[1];a.justify=s,$(this).parents(".editable-field").css("text-align",s),$(this).addClass("sel")}),$(document).hammer().on("tap",".text-controls .strikethrough",function(e){e.preventDefault(),e.stopPropagation();var t=$(this).parents(".editable-field"),a=_.findWhere(newBag.data.textfields,{domid:t.attr("id")});$(this).hasClass("sel")?($(this).removeClass("sel"),t.removeClass("strikethrough"),delete a.strikethrough):($(this).addClass("sel"),t.addClass("strikethrough"),a.strikethrough="strikethrough")}),$(document).on("input",".type-control input",function(t){t.preventDefault(),t.stopPropagation(),e($(this))}),$(document).hammer().on("drag",".editable-field, editable-field .corner",function(e){if(1!==$(e.target).parents(".text-controls").length){site.isTouch()&&($(".content-wrap").css("overflow","hidden"),$("body").addClass("lock-scroll"));var t=$(this);if($(this).hasClass("corner")&&(t=$(this).parents(".editable-field")),"up"===e.gesture.direction||"down"===e.gesture.direction){var a=e.gesture.deltaY,s=t.attr("id"),i=parseInt(t.parents(".bag-body").css("font-size")),n=_.findWhere(newBag.data.textfields,{domid:s}),o=n.y*i,l=a+o;0>l?l=0:l+t.height()>t.parents(".textfields-wrap").height()&&(l=t.parents(".textfields-wrap").height()-t.height()),TweenLite.to(t,0,{y:l+"px"})}}}),$(document).hammer().on("dragend",".editable-field, editable-field .corner",function(e){if(1!==$(e.target).parents(".text-controls").length){site.isTouch()&&($(".content-wrap").css("overflow","auto"),$("body").removeClass("lock-scroll"));var t=$(this);if(0!==$(this).parents(".editable-field").length&&(t=$(this).parents(".editable-field")),"up"===e.gesture.direction||"down"===e.gesture.direction){var a=e.gesture.deltaY,s=t.attr("id"),i=parseInt(t.parents(".bag-body").css("font-size")),n=_.findWhere(newBag.data.textfields,{domid:s}),o=n.y*i,l=a+o;0>l?l=0:l+t.height()>t.parents(".textfields-wrap").height()&&(l=t.parents(".textfields-wrap").height()-t.height()),n.y=l/i}}}),$(document).hammer().on("tap","button.save:not(.disabled), button.save:not(.disabled) span",function(){newBag.saveAs()})});