var newBag;$(document).ready(function(){function e(e){var t=e.parents(".editable-field"),a=_.findWhere(newBag.data.textfields,{_id:t.attr("data-id")});if(e.parent().hasClass("size")){var n=e.val();t.css("font-size",n+"em"),a.fontSize=Number(n)}else if(e.parent().hasClass("kerning")){var i=e.val();t.css("letter-spacing",i+"em"),a.kerning=Number(i)}else if(e.parent().hasClass("leading")){var s=e.val();t.css("line-height",s+"em"),a.leading=Number(s)}newBag.updateTextAreaSize(t.find("textarea"))}newBag=_.extend({},bagObject),newBag.data.editMode=!0,newBag.newTextField(),newBag.draw($(".content.create-page .bag-wrap"),function(){$(".editable-field").eq(0).addClass("selected"),$(".editable-field").eq(0).find("textarea").focus(),setTimeout(function(){var e=$(document).height()-$(window).height();$("body").animate({scrollTop:e},"slow")},100)}),$(document).hammer().on("tap",".bag-size-wrap .selector",function(e){e.preventDefault(),e.stopPropagation();var t=$(this).parents(".bag-size-wrap");t.hasClass("small")?(t.removeClass("small"),t.addClass("big"),newBag.toggleSize("big")):t.hasClass("big")&&(t.removeClass("big"),t.addClass("small"),newBag.toggleSize("small"))}),$(document).hammer().on("tap",".color-control-wrap .color-control",function(e){e.preventDefault(),e.stopPropagation(),$(this).parents(".color-control-wrap").toggleClass("expand")}),$(document).hammer().on("tap",".color-control-wrap .colors .color-wrap",function(e){e.preventDefault(),e.stopPropagation();var t=$(this).parents(".color").attr("rel");newBag.changeColor(t),$(this).parents(".color-control-wrap").removeClass("expand")}),$(document).hammer().on("tap",".addTextfield:not(.disabled)",function(e){e.preventDefault(),e.stopPropagation(),$(".editable-field.new").length>0?($(".editable-field").removeClass("selected"),setTimeout(function(){$(".editable-field.new").eq(0).addClass("selected")},100)):(newBag.newTextField(),newBag.draw())}),$(document).hammer().on("tap",".editable-field .corner.tr",function(e){e.preventDefault(),e.stopPropagation();var t=$(this).parents(".editable-field").attr("data-id");newBag.deleteTextField(t)}),$(document).on("keyup",".editable-field textarea",function(){newBag.updateTextAreaSize($(this))}),$(document).hammer().on("tap",".editable-field",function(e){e.preventDefault(),e.stopPropagation(),$(".editable-field").removeClass("selected"),$(this).addClass("selected")}),$(document).hammer().on("tap",":not(.editable-field, .editable-field *)",function(e){e.preventDefault(),e.stopPropagation(),$(".editable-field.selected").removeClass("selected")}),$(document).hammer().on("tap",".text-controls .justification > *",function(e){e.preventDefault(),e.stopPropagation();var t=$(this).parents(".editable-field"),a=_.findWhere(newBag.data.textfields,{_id:t.attr("data-id")});$(this).siblings(".sel").removeClass("sel");var n=$(this).attr("class").split("-")[1];a.justify=n,$(this).parents(".editable-field").css("text-align",n),$(this).addClass("sel")}),$(document).on("input",".type-control input",function(){e($(this))}),$(document).on("change",".type-control input",function(){e($(this))}),$(document).hammer().on("drag",".editable-field, editable-field .corner",function(e){if(1!==$(e.target).parents(".text-controls").length){var t=$(this);if(0!==$(this).parents(".editable-field").length&&(t=$(this).parents(".editable-field")),"up"===e.gesture.direction||"down"===e.gesture.direction){var a=e.gesture.deltaY,n=t.attr("data-id"),i=parseInt(t.parents(".bag-body").css("font-size")),s=_.findWhere(newBag.data.textfields,{_id:n}),r=s.y*i,l=a+r;0>l?l=0:l+t.height()>t.parents(".textfields-wrap").height()&&(l=t.parents(".textfields-wrap").height()-t.height()),TweenLite.to(t,0,{y:l+"px"})}}}),$(document).hammer().on("dragend",".editable-field, editable-field .corner",function(e){if(1!==$(e.target).parents(".text-controls").length){var t=$(this);if(0!==$(this).parents(".editable-field").length&&(t=$(this).parents(".editable-field")),"up"===e.gesture.direction||"down"===e.gesture.direction){var a=e.gesture.deltaY,n=t.attr("data-id"),i=parseInt(t.parents(".bag-body").css("font-size")),s=_.findWhere(newBag.data.textfields,{_id:n}),r=s.y*i,l=a+r;0>l?l=0:l+t.height()>t.parents(".textfields-wrap").height()&&(l=t.parents(".textfields-wrap").height()-t.height()),s.y=l/i}}}),$(document).hammer().on("tap","button.save",function(){newBag.saveAs()})});