var viewPage={getToteGridHTML:function(e,t){"undefined"!=typeof e[0]&&(e=e[0]);var o=e._id,a=_.findWhere(browse.toteBags,{_id:o});if("undefined"==typeof a){var r={bags:[e]};$.get("/templates/_bag.html",function(e){var o=Handlebars.compile(e),a=o(r),i=$("<div />",{"class":"tote-grid-element view "+r.bags[0].color,"data-id":r.bags[0]._id,html:a});t(i,-1)})}else{var i=_.indexOf(browse.toteBags,a),n=$(".browse-tote-wrap .tote-grid-element").eq(i),s=$("<div />",{"class":n.attr("class")+" view","data-id":o,html:n.html()});t(s,i)}},nextTote:function(){function e(e){viewPage.getToteGridHTML(e,function(e){$(".browse-tote-wrap .tote-grid-element").length<i&&browse.loadMoreBags(),TweenLite.to(".view-carousel .tote-grid-element .actual-tote",.3,{rotation:"-10deg",ease:gridBagBezier,onComplete:function(){TweenLite.to(".view-carousel .tote-grid-element .actual-tote",.3,{rotation:"0deg",ease:gridBagBezier})}}),TweenLite.to(".view-carousel .tote-grid-element .tote-shadow",.3,{rotation:"10deg",scaleX:.9,ease:gridBagBezier,onComplete:function(){TweenLite.to(".view-carousel .tote-grid-element .tote-shadow",.3,{rotation:"0deg",ease:gridBagBezier})}}),TweenLite.to(t,.5,{x:-r,ease:cssBezier,onComplete:function(){t.append(e),t.find(".tote-grid-element:first-child").remove(),TweenLite.to(t,0,{x:0}),$(".view-carousel").attr("data-display",a).attr("data-index",n),window.history.pushState("html","Title","/"+browse.currSort+"/tote/"+a),site.refreshTypeOnTotes(),$(".view-carousel-wrap .tote-grid-element .tote-shadow").css("opacity","1");var o=_.findWhere(browse.toteBags,{_id:a});$(".view-controls .heart-outer-wrap").attr("class","heart-outer-wrap "+o.color),viewPage.updateLikes(),bagObject.upViewCount(a)}})})}var t=$(".view-carousel-wrap"),o=parseInt($(".view-carousel").attr("data-index")),a=$(".view-carousel .tote-grid-element:last-child").attr("data-id"),r=t.find(".tote-grid-element").outerWidth(),i=o+2,n=o+1;o>=browse.totalBags-2&&(i=2-(browse.totalBags-o)),n>=browse.totalBags&&(n=0),browse.getToteObjFromIndex(i,e)},prevTote:function(){function e(e){viewPage.getToteGridHTML(e,function(e){TweenLite.to(".view-carousel .tote-grid-element .actual-tote",.3,{rotation:"10deg",ease:gridBagBezier,onComplete:function(){TweenLite.to(".view-carousel .tote-grid-element .actual-tote",.3,{rotation:"0deg",ease:gridBagBezier})}}),TweenLite.to(".view-carousel .tote-grid-element .tote-shadow",.3,{rotation:"-10deg",scaleX:.9,ease:gridBagBezier,onComplete:function(){TweenLite.to(".view-carousel .tote-grid-element .tote-shadow",.3,{rotation:"0deg",ease:gridBagBezier})}}),TweenLite.to(t,.5,{x:r,ease:cssBezier,onComplete:function(){t.prepend(e),t.find(".tote-grid-element:last-child").remove(),TweenLite.to(t,0,{x:0}),t.parents(".view-carousel").attr("data-display",a).attr("data-index",n),window.history.pushState("html","Title","/"+browse.currSort+"/tote/"+a),site.refreshTypeOnTotes(),$(".view-carousel-wrap .tote-grid-element .tote-shadow").css("opacity","1");var o=_.findWhere(browse.toteBags,{_id:a});$(".view-controls .heart-outer-wrap").attr("class","heart-outer-wrap "+o.color),viewPage.updateLikes(),bagObject.upViewCount(a)}})})}var t=$(".view-carousel-wrap"),o=parseInt($(".view-carousel").attr("data-index")),a=$(".view-carousel .tote-grid-element:first-child").attr("data-id"),r=t.find(".tote-grid-element").outerWidth(),i=o-2,n=o-1;1>=o&&(i=browse.totalBags-(2-o)),0>n&&(n=browse.totalBags-1),browse.getToteObjFromIndex(i,e)},updateLikes:function(){var e=$(".view-carousel").attr("data-display");likes.indexOf(e)>-1&&!$(".view-controls .heart-outer-wrap").hasClass("favorited")?likes.favorite($(".view-controls .heart-outer-wrap")):-1===likes.indexOf(e)&&$(".view-controls .heart-outer-wrap").hasClass("favorited")&&likes.unfavorite($(".view-controls .heart-outer-wrap"))}};$(document).ready(function(){$(document).hammer().on("tap",".view-controls button.left",function(){viewPage.prevTote()}),$(document).hammer().on("tap",".view-controls button.right",function(){viewPage.nextTote()}),$(document).hammer().on("tap",".view-carousel.on button.close, .view-carousel.on button.close span",function(e){e.preventDefault(),e.stopPropagation(),browse.viewZoomOut()}),$(document).on("keyup",function(e){if($(".view-carousel").hasClass("on"))if(39===e.keyCode)viewPage.nextTote();else if(37===e.keyCode)viewPage.prevTote();else if(38===e.keyCode){var t=$(".view-carousel-wrap").scrollTop();$(".view-carousel-wrap").scrollTop(t-10)}else if(40===e.keyCode){var t=$(".view-carousel-wrap").scrollTop();$(".view-carousel-wrap").scrollTop(t+10)}else 27===e.keyCode&&browse.viewZoomOut()}),$(document).hammer().on("drag",".view-carousel-wrap",function(e){e.preventDefault(),e.stopPropagation();var t=e.gesture.direction;("left"===t||"right"===t)&&(site.isTouch()&&$(".view-carousel-wrap").css("overflow","hidden"),TweenLite.to($(this),0,{x:e.gesture.deltaX}),"left"===t?(TweenLite.to(".view-carousel .tote-grid-element .actual-tote",.3,{rotation:"-3deg",ease:gridBagBezier,onComplete:function(){TweenLite.to(".view-carousel .tote-grid-element .actual-tote",.3,{rotation:"0deg",ease:gridBagBezier})}}),TweenLite.to(".view-carousel .tote-grid-element .tote-shadow",.3,{rotation:"3deg",scaleX:.9,ease:gridBagBezier,onComplete:function(){TweenLite.to(".view-carousel .tote-grid-element .tote-shadow",.3,{rotation:"0deg",ease:gridBagBezier})}})):(TweenLite.to(".view-carousel .tote-grid-element .actual-tote",.3,{rotation:"3deg",ease:gridBagBezier,onComplete:function(){TweenLite.to(".view-carousel .tote-grid-element .actual-tote",.3,{rotation:"0deg",ease:gridBagBezier})}}),TweenLite.to(".view-carousel .tote-grid-element .tote-shadow",.3,{rotation:"-3deg",scaleX:.9,ease:gridBagBezier,onComplete:function(){TweenLite.to(".view-carousel .tote-grid-element .tote-shadow",.3,{rotation:"0deg",ease:gridBagBezier})}})))}),$(document).hammer().on("dragend",".view-carousel-wrap",function(e){e.preventDefault(),e.stopPropagation();var t=e.gesture.direction;!site.isTouch()||"left"!==t&&"right"!==t||$(".view-carousel-wrap").css("overflow","auto"),"left"===t?viewPage.nextTote():"right"===t&&viewPage.prevTote()}),$(".view-carousel-wrap").scroll(function(){var e=$(".view-carousel-wrap").scrollTop(),t=$(".view-carousel-wrap").height();e>t/2&&$(".view-carousel-wrap").scrollTop(t/2)})});