function resizeHelper(){site.refreshTypeOnTotes(),"sml"!==site.breakpt()?TweenLite.to("nav",0,{y:0}):scrollHelper()}function scrollHelper(){var e=$("body").scrollTop();if($("nav").length>0&&"sml"===site.breakpt()){var t=80;e<$("nav .logo").height()&&(t=e),TweenLite.to("nav",0,{y:-t})}}var cssBezier=new Ease(BezierEasing(.7,0,.3,1)),gridBagBezier=new Ease(BezierEasing(.42,0,.58,1));!function(e,t,i,n,a,s,o){e.GoogleAnalyticsObject=a,e[a]=e[a]||function(){(e[a].q=e[a].q||[]).push(arguments)},e[a].l=1*new Date,s=t.createElement(i),o=t.getElementsByTagName(i)[0],s.async=1,s.src=n,o.parentNode.insertBefore(s,o)}(window,document,"script","//www.google-analytics.com/analytics.js","ga"),ga("create","UA-58975311-1","auto");var likes={userLikes:[],fetchUserLikes:function(){var e=$.cookie("likes");likes.userLikes=e.split(",")},likeBag:function(e){return likes.indexOf(e)>-1?!1:(likes.userLikes.push(e),$.cookie("likes",likes.userLikes),browse.loadBags(function(){var t=_.findWhere(browse.toteBags,{_id:e});t.likes=parseInt(t.likes)+1;var i=_.extend({},t);delete i._id,delete i.swingTimer,delete i.stopTimer,$.ajax({type:"PUT",data:JSON.stringify(i),url:"/totes/updatetote/"+e,contentType:"application/json; charset=utf-8",dataType:"json"}).done(function(){}).fail(function(){})}),void 0)},unlikeBag:function(e){var t=likes.indexOf(e);return t>-1?(likes.userLikes.splice(t,1),$.cookie("likes",likes.userLikes),browse.loadBags(function(){var t=_.findWhere(browse.toteBags,{_id:e});t.likes=parseInt(t.likes)-1;var i=_.extend({},t);delete i._id,delete i.swingTimer,delete i.stopTimer,$.ajax({type:"PUT",data:JSON.stringify(i),url:"/totes/updatetote/"+e,contentType:"application/json; charset=utf-8",dataType:"json"}).done(function(){}).fail(function(){})}),void 0):!1},indexOf:function(e){return likes.userLikes.indexOf(e)},toggleLike:function(e){likes.indexOf(e)>-1?likes.unlikeBag(e):likes.likeBag(e)},favorite:function(e){e.css("background-color","#D93182"),e.find(".heart .inner-heart").css("opacity","0"),e.find(".heart .white").css("opacity","1"),e.find(".heart").css("opacity","1"),TweenLite.to(e,.3,{backgroundColor:"#fff",ease:cssBezier,delay:.1}),TweenLite.to(e.find(".heart"),.15,{alpha:0,scale:1.1,ease:cssBezier,delay:.1,onComplete:function(){e.find(".heart .inner-heart").css("opacity","0"),e.find(".heart .magenta").css("opacity","1"),TweenLite.to(e.find(".heart"),.15,{alpha:1,ease:cssBezier,onComplete:function(){e.parents(".heart-outer-wrap").addClass("favorited")}})}})},unfavorite:function(e){e.css("background-color","#D93182"),e.find(".heart .inner-heart").css("opacity","0"),e.find(".heart .white").css("opacity","1"),e.find(".heart").css("opacity","1"),TweenLite.to(e,.3,{backgroundColor:"#fff",ease:cssBezier,delay:.1}),TweenLite.to(e.find(".heart"),.15,{alpha:0,scale:1.1,ease:cssBezier,delay:.1,onComplete:function(){e.find(".heart .inner-heart").css("opacity","0"),e.find(".heart .grey").css("opacity","1"),TweenLite.to(e.find(".heart"),.15,{alpha:1,ease:cssBezier,onComplete:function(){e.parents(".heart-outer-wrap").removeClass("favorited")}})}})}},site={colors:["black","white","red"],chars:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz".split(""),randomString:function(e){for(var t="",i=0;e>i;i++)t+=site.chars[Math.floor(Math.random()*site.chars.length)];return t},breakpts:{sml:650,med:960,lrg:1440},transistionEnd:"webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend",breakpt:function(){var e=window.innerWidth,t="lrg";for(var i in site.breakpts)if(site.breakpts[i]>=e){t=i;break}return t},refreshTypeOnTotes:function(){_.each($(".actual-tote"),function(e){var t=$(e).find(".bag-body").width(),i=t/2;if($(e).find(".bag-body").css("font-size",i+"px"),$(e).find(".bag-bottom").css("font-size",i+"px"),$(e).find(".editable-field").length>0)for(var n=$(e).find(".textfields-wrap .editable-field"),a=0;a<n.length;a++)bagObject.updateTextAreaSize($(n[a]).find("textarea"));if($(e).find(".text").length>0)for(var s=$(e).find(".textfields-wrap .text"),o=0;o<s.length;o++){var r=Number($(s[o]).attr("data-x"))*i,d=Number($(s[o]).attr("data-y"))*i;TweenLite.to(s[o],0,{x:r,y:d})}})},getTransformValue:function(e,t){var i=e.css("transform").replace(/[^0-9\-.,]/g,"").split(","),n=i[12]||i[4],a=i[13]||i[5];return void 0===n&&(n=0),void 0===a&&(a=0),"x"===t?n:"y"===t?a:void 0},render:function(e,t,i,n){$.get("/templates/_"+t+".html",function(t){var a=Handlebars.compile(t),s=a(e);$(i).html(s),"undefined"!=typeof n&&n()})},breakpts:{sml:640,med:940,lrg:1280},breakpt:function(){var e=window.innerWidth,t="lrg";for(var i in site.breakpts)if(site.breakpts[i]>=e){t=i;break}return t}},bagObject={data:{textfields:[],size:"small",color:"black",likes:0,editMode:!1},htmlElement:null,parent:null,refreshType:function(){var e=this.htmlElement,t=e.find(".bag-body").width(),i=t/2;e.find(".bag-body").css("font-size",i+"px"),e.find(".bag-bottom").css("font-size",i+"px"),setTimeout(function(){site.refreshTypeOnTotes()},100)},toggleSize:function(e){var t=this;"big"===e||"small"===t.data.size&&"undefined"==typeof e?(t.data.size="big",t.htmlElement.removeClass("small").addClass("big")):("small"===e||"big"===t.data.size&&"undefined"==typeof e)&&(t.data.size="small",t.htmlElement.removeClass("big").addClass("small")),setTimeout(function(){t.refreshType()},300)},changeColor:function(e){var t=this;_.contains(site.colors,e)&&($(t.htmlElement).attr("class","tote-wrap "+e+" "+t.data.size),t.data.color=e)},updateTextAreaSize:function(e){var t=this,i=e.parents(".editable-field"),n=i.attr("id"),a=e.siblings(".clone-text-wrap").find(".clone-text"),s=e.val();if(""===s&&(s="Type Something."),contentFormatted=s.replace(/\n/g,"<br/>"),a.html(contentFormatted),t.data&&t.data.textfields){var o=_.findWhere(t.data.textfields,{domid:n});o.text=s,""===e.val()?i.addClass("new"):i.removeClass("new");var r=parseInt(i.parents(".bag-body").css("font-size")),d=o.x*r,l=o.y*r;TweenLite.to(i,0,{x:d,y:l})}TweenLite.to(i,.1,{height:a.height()})},draw:function(e,t){var i=this;if("undefined"==typeof e&&null!==i.parent)e=$(i.parent);else{if(null===i.parent&&"undefined"==typeof e)return void console.log("you done fucked up");null===i.parent&&"undefined"!=typeof e&&(i.parent=e)}var n={bags:[i.data]};site.render(n,"bag",i.parent,function(){i.htmlElement=i.parent.find(".tote-wrap"),site.refreshTypeOnTotes(),"undefined"!=typeof t&&t()})},newTextField:function(){for(var e={y:0,x:0,width:"100%",justify:"left",fontSize:.28,kerning:-.03,leading:1},t=site.randomString(16);"undefined"!=typeof _.findWhere(this.data.textfields,{domid:t});)id=site.randomString(16);e.domid=t,this.data.textfields.push(e),this.data.textfields.length>=4&&$(".addTextfield").addClass("disabled")},deleteTextField:function(e,t){var i=this,n=$(this.htmlElement).find(".editable-field#"+e);TweenLite.to(n,.3,{scale:1.15,alpha:0,onComplete:function(){n.remove(),i.data.textfields=_.reject(i.data.textfields,function(t){return t.domid===e}),i.data.textfields.length<4&&$(".addTextfield").removeClass("disabled"),"undefined"!=typeof t&&t()}})},saveAs:function(){var e=_.extend({},this.data);delete e.editMode,e.timestamp=Math.round((new Date).getTime()/1e3),$.ajax({type:"POST",data:JSON.stringify(e),url:"/totes/createtote",contentType:"application/json; charset=utf-8",dataType:"json"}).done(function(){window.location.href="/"}).fail(function(e){alert("Something went wrong :(. Error: "+e.msg)})}};$(document).ready(function(){void 0===$.cookie("likes")&&$.cookie("likes",""),$(document).hammer().on("tap",".logo, button.close",function(){window.location.href="/"}),site.refreshTypeOnTotes(),$(window).resize(function(){resizeHelper()}),$(window).scroll(function(){scrollHelper()}),ga("send","pageview")});